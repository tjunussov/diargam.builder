
<!-- saved from url=(0037)http://webkit.org/demos/sticky-notes/ -->
<html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-doctype">&lt;!doctype html&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;html <span class="webkit-html-attribute-name">manifest</span>="<span class="webkit-html-attribute-value">StickyNotes.manifest</span>"&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;head&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;title&gt;</span>WebKit HTML 5 SQL Storage Notes Demo&lt;/title&gt;<span class="webkit-html-tag"></span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;style&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">body {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    font-family: 'Lucida Grande', 'Helvetica', sans-serif;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">.note {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    background-color: rgb(255, 240, 70);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    height: 250px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    padding: 10px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    position: absolute;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    width: 200px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    -webkit-box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.5);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">.note:hover .closebutton {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    display: block;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">.closebutton {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    display: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    background-image: url(deleteButton.png);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    height: 30px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    position: absolute;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    left: -15px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    top: -15px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    width: 30px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">.closebutton:active {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    background-image: url(deleteButtonPressed.png);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">.edit {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    outline: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">.timestamp {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    position: absolute;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    left: 0px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    right: 0px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    bottom: 0px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    font-size: 9px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    background-color: #db0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    color: white;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    border-top: 1px solid #a80;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    padding: 2px 4px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    text-align: right;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">&lt;/style&gt;<span class="webkit-html-tag"></span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var db = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">try {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    if (window.openDatabase) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        db = openDatabase("NoteTest", "1.0", "HTML5 Database API example", 200000);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!db)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            alert("Failed to open the database on disk.  This is probably because the version was bad or there is not enough space left in this domain's quota");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    } else</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        alert("Couldn't open the database.  Please try with a WebKit nightly with this feature enabled");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">} catch(err) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    db = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    alert("Couldn't open the database.  Please try with a WebKit nightly with this feature enabled");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var captured = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var highestZ = 0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var highestId = 0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function Note()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var self = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var note = document.createElement('div');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.className = 'note';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.addEventListener('mousedown', function(e) { return self.onMouseDown(e) }, false);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.addEventListener('click', function() { return self.onNoteClick() }, false);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    this.note = note;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var close = document.createElement('div');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    close.className = 'closebutton';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    close.addEventListener('click', function(event) { return self.close(event) }, false);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.appendChild(close);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var edit = document.createElement('div');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    edit.className = 'edit';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    edit.setAttribute('contenteditable', true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    edit.addEventListener('keyup', function() { return self.onKeyUp() }, false);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.appendChild(edit);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    this.editField = edit;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var ts = document.createElement('div');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    ts.className = 'timestamp';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    ts.addEventListener('mousedown', function(e) { return self.onMouseDown(e) }, false);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.appendChild(ts);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    this.lastModified = ts;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    document.body.appendChild(note);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    return this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">Note.prototype = {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    get id()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!("_id" in this))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            this._id = 0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return this._id;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    set id(x)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this._id = x;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    get text()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return this.editField.innerHTML;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    set text(x)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.editField.innerHTML = x;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    get timestamp()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!("_timestamp" in this))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            this._timestamp = 0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return this._timestamp;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    set timestamp(x)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (this._timestamp == x)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this._timestamp = x;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var date = new Date();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        date.setTime(parseFloat(x));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.lastModified.textContent = modifiedString(date);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    get left()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return this.note.style.left;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    set left(x)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.style.left = x;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    get top()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return this.note.style.top;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    set top(x)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.style.top = x;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    get zIndex()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return this.note.style.zIndex;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    set zIndex(x)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.style.zIndex = x;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    close: function(event)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.cancelPendingSave();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var note = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        db.transaction(function(tx)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            tx.executeSql("DELETE FROM WebKitStickyNotes WHERE id = ?", [note.id]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var duration = event.shiftKey ? 2 : .25;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.style.webkitTransition = '-webkit-transform ' + duration + 's ease-in, opacity ' + duration + 's ease-in';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.offsetTop; // Force style recalc</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.style.webkitTransformOrigin = "0 0";</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.style.webkitTransform = 'skew(30deg, 0deg) scale(0)';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.note.style.opacity = '0';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var self = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        setTimeout(function() { document.body.removeChild(self.note) }, duration * 1000);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    saveSoon: function()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.cancelPendingSave();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var self = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this._saveTimer = setTimeout(function() { self.save() }, 200);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    cancelPendingSave: function()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!("_saveTimer" in this))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        clearTimeout(this._saveTimer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        delete this._saveTimer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    save: function()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.cancelPendingSave();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if ("dirty" in this) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            this.timestamp = new Date().getTime();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            delete this.dirty;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var note = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        db.transaction(function (tx)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            tx.executeSql("UPDATE WebKitStickyNotes SET note = ?, timestamp = ?, left = ?, top = ?, zindex = ? WHERE id = ?", [note.text, note.timestamp, note.left, note.top, note.zIndex, note.id]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    saveAsNew: function()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.timestamp = new Date().getTime();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var note = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        db.transaction(function (tx) </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            tx.executeSql("INSERT INTO WebKitStickyNotes (id, note, timestamp, left, top, zindex) VALUES (?, ?, ?, ?, ?, ?)", [note.id, note.text, note.timestamp, note.left, note.top, note.zIndex]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }); </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    onMouseDown: function(e)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        captured = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.startX = e.clientX - this.note.offsetLeft;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.startY = e.clientY - this.note.offsetTop;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.zIndex = ++highestZ;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var self = this;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!("mouseMoveHandler" in this)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            this.mouseMoveHandler = function(e) { return self.onMouseMove(e) }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            this.mouseUpHandler = function(e) { return self.onMouseUp(e) }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        document.addEventListener('mousemove', this.mouseMoveHandler, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        document.addEventListener('mouseup', this.mouseUpHandler, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    onMouseMove: function(e)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (this != captured)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.left = e.clientX - this.startX + 'px';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.top = e.clientY - this.startY + 'px';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    onMouseUp: function(e)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        document.removeEventListener('mousemove', this.mouseMoveHandler, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        document.removeEventListener('mouseup', this.mouseUpHandler, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.save();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    onNoteClick: function(e)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.editField.focus();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        getSelection().collapseToEnd();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    onKeyUp: function()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.dirty = true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        this.saveSoon();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function loaded()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    db.transaction(function(tx) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        tx.executeSql("SELECT COUNT(*) FROM WebkitStickyNotes", [], function(result) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            loadNotes();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }, function(tx, error) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            tx.executeSql("CREATE TABLE WebKitStickyNotes (id REAL UNIQUE, note TEXT, timestamp REAL, left TEXT, top TEXT, zindex REAL)", [], function(result) { </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                loadNotes(); </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function loadNotes()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    db.transaction(function(tx) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        tx.executeSql("SELECT id, note, timestamp, left, top, zindex FROM WebKitStickyNotes", [], function(tx, result) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            for (var i = 0; i &lt; result.rows.length; ++i) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var row = result.rows.item(i);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var note = new Note();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                note.id = row['id'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                note.text = row['note'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                note.timestamp = row['timestamp'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                note.left = row['left'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                note.top = row['top'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                note.zIndex = row['zindex'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                if (row['id'] &gt; highestId)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                    highestId = row['id'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                if (row['zindex'] &gt; highestZ)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                    highestZ = row['zindex'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (!result.rows.length)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                newNote();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }, function(tx, error) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            alert('Failed to retrieve notes from database - ' + error.message);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function modifiedString(date)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    return 'Last Modified: ' + date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate() + ' ' + date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function newNote()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var note = new Note();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.id = ++highestId;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.timestamp = new Date().getTime();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.left = Math.round(Math.random() * 400) + 'px';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.top = Math.round(Math.random() * 500) + 'px';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.zIndex = ++highestZ;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    note.saveAsNew();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">if (db != null)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    addEventListener('load', loaded, false);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">&lt;/script&gt;<span class="webkit-html-tag"></span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/head&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;body&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;p&gt;</span>This page demonstrates the use of the <span class="webkit-html-tag">&lt;a <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-external-link" target="_blank" href="http://www.whatwg.org/specs/web-apps/current-work/multipage/section-sql.html">http://www.whatwg.org/specs/web-apps/current-work/multipage/section-sql.html</a>"&gt;</span>HTML 5 Client-side Database Storage API<span class="webkit-html-tag">&lt;/a&gt;</span>. Any notes you create will be saved in a database on your local hard drive, and will be reloaded from that database the next time you visit this page. To try it out, use a <span class="webkit-html-tag">&lt;a <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-external-link" target="_blank" href="http://nightly.webkit.org/">http://nightly.webkit.org/</a>"&gt;</span>WebKit Nightly Build<span class="webkit-html-tag">&lt;/a&gt;</span>.<span class="webkit-html-tag">&lt;/p&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;button <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">newNoteButton</span>" <span class="webkit-html-attribute-name">onclick</span>="<span class="webkit-html-attribute-value">newNote()</span>"&gt;</span>New Note<span class="webkit-html-tag">&lt;/button&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">document.getElementById("newNoteButton").disabled = !db;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">&lt;/script&gt;<span class="webkit-html-tag"></span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/body&gt;</span> </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/html&gt;</span> </td></tr></tbody></table></body></html>